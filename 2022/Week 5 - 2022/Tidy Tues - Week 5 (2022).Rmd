---
title: "Tidy Tuesday - Week 5 (2022)"
author: "Julia Tache"
date: "2/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r load data}
library(tidytuesdayR)
library(tidyverse)

breed_traits <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-01/breed_traits.csv")
trait_description <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-01/trait_description.csv")
breed_rank_all <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-01/breed_rank.csv")

head(breed_traits)
head(trait_description)
head(breed_rank_all)
```

```{r}
breed_traits$Breed <- iconv(breed_traits$Breed, from = 'UTF-8', to = 'ASCII//TRANSLIT')

breed_rank_all_2020 <- breed_rank_all %>%
  select(Breed, `2020 Rank`)
  
breed_rank_all_2020 <- breed_rank_all_2020[order(breed_rank_all_2020$`2020 Rank`),][1:10, ] # top 10 dog breeds 2020

breed_traits_10 <- breed_traits %>%
 dplyr::filter(Breed == as.character(breed_rank_all_2020$Breed))

breed_traits_10 <- breed_traits_10 %>%
  select(Breed, `Affectionate With Family`, `Shedding Level`, `Trainability Level`, `Energy Level`, `Barking Level`)

breed_traits_10 <- breed_traits_10 %>% remove_rownames %>% column_to_rownames(var = "Breed")

max_min <- data.frame(
  `Affectionate With Family` = c(5, 0), `Shedding Level` = c(5, 0), `Trainability Level` = c(5, 0),
  `Energy Level` = c(5, 0), `Barking Level` = c(5, 0)
)
rownames(max_min) <- c("Max", "Min")

colnames(max_min) <- c("Affectionate With Family", "Shedding Level", "Trainability Level", 
                       "Energy Level", "Barking Level")

# Bind the variable ranges to the data
breed_traits_10 <- rbind(max_min, breed_traits_10)
breed_traits_10
```

```{r}
# helper function from https://www.datanovia.com/en/blog/beautiful-radar-chart-in-r-using-fmsb-and-ggplot-packages/

create_beautiful_radarchart <- function(data, color = "#00AFBB", 
                                        vlabels = colnames(data), vlcex = 0.7,
                                        caxislabels = NULL, title = NULL, ...){
  radarchart(
    data, axistype = 1,
    # Customize the polygon
    pcol = color, pfcol = scales::alpha(color, 0.5), plwd = 2, plty = 1,
    # Customize the grid
    cglcol = "grey", cglty = 1, cglwd = 0.8,
    # Customize the axis
    axislabcol = "grey", 
    # Variable labels
    vlcex = vlcex, vlabels = vlabels,
    caxislabels = caxislabels, title = title, ...
  )
}

par(mar = rep(1, 4))
par(mfrow = c(2, 5))

for(i in 1:10){
  create_beautiful_radarchart(
    data = breed_traits_10[c(1, 2, i+2), ], caxislabels = c(1, 2, 3, 4, 5),
    title = row.names(breed_traits_10)[i+2]
    )
}

par(op)

```


```{r}
breed_traits_10_scaled <- round(apply(breed_traits_10, 2, scales::rescale), 2)
breed_traits_10_scaled <- as.data.frame(breed_traits_10_scaled)

head(breed_traits_10_scaled)

# Variables summary
# code from https://www.datanovia.com/en/blog/beautiful-radar-chart-in-r-using-fmsb-and-ggplot-packages/

# Get the minimum and the max of every column  
col_max <- apply(breed_traits_10_scaled, 2, max)
col_min <- apply(breed_traits_10_scaled, 2, min)
# Calculate the average profile 
col_mean <- apply(breed_traits_10_scaled, 2, mean)
# Put together the summary of columns
col_summary <- t(data.frame(Max = col_max, Min = col_min, Average = col_mean))


# Bind variables summary to the data
breed_traits_10_scaled2 <- as.data.frame(rbind(col_summary, breed_traits_10_scaled))
breed_traits_10_scaled2
```

```{r}
library(fmsb)

opar <- par()
par(mar = rep(1, 4))
par(mfrow = c(2, 5))

for (i in 4:nrow(breed_traits_10_scaled2)) {
  radarchart(
    breed_traits_10_scaled2[c(4:13, i), ], 
    pfcol = c("#99999980", NA),
    pcol= c(NA, 2), plty = 1, plwd = 2,
    title = row.names(breed_traits_10_scaled2)[i]
    )
}

par <- par(opar)

```


```{r prepare data for graphing}

joined_df <- left_join(ratings, details, by = "id")

joined_df$boardgamecategory <- gsub("\\[|\\]", "", joined_df$boardgamecategory)
joined_df$boardgamecategory <- gsub("'", "", joined_df$boardgamecategory)
joined_df$boardgamecategory <- gsub('"', "", joined_df$boardgamecategory)
joined_df$boardgamecategory <- gsub('Childrens Game', "Children's Game", joined_df$boardgamecategory)
joined_df$boardgamecategory <- trimws(joined_df$boardgamecategory)

joined_df$boardgamecategory <- as.list(strsplit(joined_df$boardgamecategory, ","))

joined_df$boardgamecategory <- sapply(joined_df$boardgamecategory, "[[", 1) # primary category

# joined_df %>%
#   count(boardgamecategory) %>%
#   arrange(desc(n))

joined_df <- joined_df %>%
  filter(boardgamecategory == "Card Game" | boardgamecategory == "Abstract Strategy" | boardgamecategory == "Adventure" | 
           boardgamecategory == "Action / Dexterity" | boardgamecategory == "Animals" | boardgamecategory == "Wargame" |
           boardgamecategory == "Bluffing" | boardgamecategory == "Economic" | boardgamecategory == "Dice" |
           boardgamecategory == "Ancient")

joined_df <- joined_df %>%
  filter(year >= 1700) %>%
  filter(year < 2020)

joined_df$century <- gsub("17\\d\\d", "18th Century", joined_df$year)
joined_df$century <- gsub("18\\d\\d", "19th Century", joined_df$century)
joined_df$century <- gsub("19\\d\\d", "20th Century", joined_df$century)
joined_df$century <- gsub("20\\d\\d", "21st Century", joined_df$century)

summary_df <- joined_df %>%
  group_by(century) %>%
  count(boardgamecategory) %>%
  group_by(century) %>%
  mutate(percent = prop.table(n))

summary_df$percent <- round(summary_df$percent * 100)

categories <- sort(unique(summary_df$boardgamecategory))
```

```{r waffle chart - category}

ggplot(summary_df, aes(fill = boardgamecategory, values = percent)) +
  geom_waffle() +
  scale_fill_manual(
    name = NULL,
    values = c("#A40E4C", "#D74E09", "#F49D6E", "#F5D6BA", "#F2BB05", "#F0F0C9", "#ACC3A6", "#124E78", "#2C2C54",  "#6E0E0A"),
    labels = categories
  ) +
  facet_wrap(~century) +
  coord_equal()  +
  theme_minimal() +
  theme_enhance_waffle() +
  labs(title = "Primary Game Categories over Centuries",
       caption = "Source: Kaggle | github: julia-tache | Jan 25th, 2022") +
  theme(plot.title = element_text(face = "italic", hjust = 0.5),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.title = element_blank()) 

ggsave("waffle.png")
```

This graph shows a waffle chart of primary game categories over the past 4 centuries, with the colors as followed: dark red for Abstract Strategy, scarlet for Action / Dexterity, light orange for Adventure, peach for Ancient, golden for Animals, light green for Bluffing, sage for Card Game, dark blue for Dice, indigo for Economic, and purple/maroon for Wargame. In the 18th century, games only fell into basic categories of Abstract Strategy, Action / Dexterity, Bluffing, Cards, and Dice, while more complex games were developed later on. Card Games have consistently been really popular, as well as Abstract Strategy, but Wargames were also very prominent in the 20th century.
